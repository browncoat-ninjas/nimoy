version: 2.1

orbs:
  python: circleci/python@1.2

workflows:
  build-and-test:
    jobs:
      - build-and-test
      - build-docs

jobs:
  build-and-test:
    docker:
      - image: cimg/python:3.8
    steps:
      - checkout
      - run:
           name: Install Pipenv
           command: pip install -U setuptools pip pipenv
      - run:
           name: Install dependencies
           command: pipenv install
      - run:
          name: Run tests
          command: pipenv run test
      - run:
          name: Run tests with power assertions
          command: pipenv run test-with-power
  build-docs:
    docker:
      - image: cimg/python:3.8
    steps:
      - checkout
      - run:
          name: Install Pipenv
          command: pip install -U setuptools pip pipenv
      - run:
          name: Install dependencies
          command: pipenv install -d
      - run:
          name: Build docs
          command: mkdocs build --verbose --clean --strict
      - persist_to_workspace:
          root: site
          paths:
            - *
